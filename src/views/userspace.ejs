<!DOCTYPE html>
<html lang="en">

<head>
     <%- include('partials/head')%>
     <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
          integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
     <link rel="stylesheet" href="/Css/userSpace.css">
     <title>Inicio</title>
</head>

<body>
     <div class="userSpaceConteiner">
          <div class="userPostArea">
               <img src="https://picsum.photos/200/300" alt="" class="userImage">
               <div class="userInformation">
                    <span class="time">11:11:11</span>
                    <p class="userName"><%= userName%></p>
               </div>
               <a href="../" class=""><i class="fas fa-power-off salir"></i></a>
          </div>
          <div class="userTextArea">
               <div contenteditable="true" class="userText"></div>
               <form action="" method="POST" class="form">
                    <input type="text" name="userName" value="<%= userName%>">
                    <input type="text" id="text" name="text" value="">
                    <input type="text" id="date" name="date" value="">
                    <input type="text" id="delete" name="delete" value="">
                    <label for="image">Subir imagen</label>
                    <input type="file" name="image" id="image">
               </form>
               <button type="submit" class="toPost"><i class="fas fa-paper-plane "></i></button>

          </div>
          <div class="userPublicationArea">

          </div>
     </div>
     <script>
          let fecha = new Date();
          let cadena = `${fecha.getFullYear()}-${fecha.getMonth()+1}-${fecha.getDate()}`;
          document.querySelector('.time').innerText = cadena;
          let boton = document.querySelector('.toPost');
          boton.addEventListener('click', () => {
               let texto = document.querySelector('.userText').innerText;
               let datePost;
               datePost =
                    `${fecha.getFullYear()}-${fecha.getMonth()+1}-${fecha.getDate()} ${fecha.getHours()}:${fecha.getMinutes()}:00`;
               document.getElementById('date').value = datePost;
               document.getElementById('text').value = texto;
               document.querySelector('.form').submit();
          });

          try {



               let data = "<%= datos%>".split(",");
               let n = data.length;
               
               for (let i = n - 1; i > 1; i -= 4) {
                        
                    let userPost = document.createElement('div');
                    userPost.className = "userPost";
                    // creando contenedores para el texto y la informacion de usuario
                    let userInformation = document.querySelector('.userPostArea').cloneNode(true);
                    userInformation.removeChild(userInformation.lastElementChild);
                    let trash = document.createElement('i');
                    // boton para eliminar
                    trash.className = "fas fa-trash trash";
                    let bottonTrash = document.createElement('button');
                    bottonTrash.id = data[i-3];
                    bottonTrash.appendChild(trash);
                    userInformation.appendChild(bottonTrash);
                    // evento para eliminar 
                    bottonTrash.addEventListener('click', (e) => {
                         
                         document.getElementById('delete').value = e.target.parentElement.getAttribute('id');
                         document.querySelector('.form').submit();

                    });
                    // crear el post del usuario
                    let userText = document.createElement('div');
                    userText.className = 'userText';
                    let text = document.createElement('p');
                    text.innerText = data[i];
                    userText.appendChild(text);
                    userPost.appendChild(userInformation);
                    userPost.appendChild(userText);

                    // insertandolo en el area de publicaciones
                    document.querySelector('.userPublicationArea').appendChild(userPost);


               }
          } catch (error) {
               console.log(error);
          }
     </script>
</body>

</html>